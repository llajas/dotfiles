# ~/.dotfiles/functions/opLogin.zsh

{{- if or (env "OP_CONNECT_HOST") (env "OP_SERVICE_ACCOUNT_TOKEN") }}

# ------------------------------------------------------------
# 1Password Connect / service-account detected → no interactive sign-in needed.
opLogin() { :; }   # noop

{{- else }}

# Login to 1Password CLI
# ~/.dotfiles/functions/opLogin.zsh
opLogin () {
  # grab the first account’s shorthand – NOT its user_uuid
  local acct=$(op account list --format=json | jq -r '.[0].shorthand')

  # Option A: classic – let 1Password emit the export line
  eval "$(op signin --account "$acct")"

  # Option B: raw token – do the export yourself
  # export OP_SESSION_${acct}="$(op signin --account "$acct" --raw)"
}

{{- end }}
